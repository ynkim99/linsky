<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linksy Profile</title>
    
    <!-- 부트스트랩 아이콘 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/profilePage.css">
    <link rel="stylesheet" href="/css/menubar.css">
</head>
<body>
    <div class="page">
        <!-- 메뉴바 include -->
        <div th:replace="~{menu_bar :: menu_bar}"></div>

        <!-- 프로필 페이지 메인 컨텐츠 -->
        <div class="profile_page">
            <!-- 프로필 상단 영역 -->
            <div class="profile_header">
                <div class="profile_info">
                    <div class="profile_image">
                        <img th:src="${member.userImg}" alt="Profile Image">
                    </div>
                    <div class="profile_details">
                        <div class="profile_name">
                            <h2 th:text="${member.userNickname}"></h2>
                            <a th:if="${isOwnProfile}" href="/profile/edit" class="edit_button">
                                <i class="bi bi-pencil-square"></i>
                            </a>
                        </div>
                        <div class="profile_stats">
                            <div class="stat">
                                <span class="stat_number" th:text="${followerCount}">0</span>
                                <span class="stat_label">팔로워</span>
                            </div>
                            <div class="stat">
                                <span class="stat_number" th:text="${followingCount}">0</span>
                                <span class="stat_label">팔로잉</span>
                            </div>
                        </div>
                        <div class="profile_bio">
                            <p th:text="${member.userIntroduce}"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 피드 그리드 -->
            <div class="feed_grid">
                <div class="grid-item" th:each="feed : ${feeds}" th:onclick="'openFeedPopup(' + ${feed.feedId} + ')'">
                    <div class="image-container">
                        <img th:each="image : ${feed.feedimages}" th:src="@{/uploads/} + ${image.imgName}" 
                             alt="Feed Image" class="full-image">
                        <div class="overlay">
                            <span th:text="'좋아요: ' + ${feed.likeAmount}"></span>
                            <span th:text="'댓글: ' + ${feed.commentCount}"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 피드 팝업 모달 -->
    <div id="feedModal" class="modal">
        <div class="modal-content">
            <div id="modalBody">
                <!-- 동적으로 피드 내용이 추가됨 -->
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        function openFeedPopup(feedId) {
            const modal = document.getElementById('feedModal');
            const modalBody = document.getElementById('modalBody');

            fetch(`/feed/popup/${feedId}`)
                .then(response => response.text())
                .then(html => {
                    modalBody.innerHTML = html;
                    modal.style.display = 'block';
                })
                .catch(error => {
                    console.error('Error:', error);
                    modalBody.innerHTML = '<p>피드를 불러오는데 실패했습니다.</p>';
                    modal.style.display = 'block';
                });
        }

        window.onclick = function(event) {
            const modal = document.getElementById('feedModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>
